<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Controle de Estoque</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #eef2f7;
      padding: 20px;
    }
    .container {
      background: #fff;
      padding: 20px;
      max-width: 900px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #333;
    }
    select, input, button {
      margin: 10px 5px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }
    th {
      background-color: #1976d2;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Admin - Controle de Estoque</h1>
    <div>
      <select id="modelo"><option value="">Escolha o modelo</option></select>
      <select id="cor"><option value="">Escolha a cor</option></select>
      <select id="malha"><option value="">Escolha o tipo de malha</option></select>
      <select id="tamanho"><option value="">Escolha o tamanho</option></select>
      <input type="number" id="quantidade" placeholder="Quantidade">
      <button onclick="entradaEstoque()">Entrada</button>
      <button onclick="saidaEstoque()">Saída</button>
      <button onclick="limparCampos()">Limpar</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>Modelo</th><th>Cor</th><th>Malha</th><th>Tamanho</th><th>Quantidade</th><th>Ações</th>
        </tr>
      </thead>
      <tbody id="tabelaEstoque"></tbody>
    </table>
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyABgUETkTIYmCa49L45E-aVQ_KddOZzyVg",
      authDomain: "controleestoque-591c5.firebaseapp.com",
      databaseURL: "https://controleestoque-591c5-default-rtdb.firebaseio.com",
      projectId: "controleestoque-591c5",
      storageBucket: "controleestoque-591c5.appspot.com",
      messagingSenderId: "726550257989",
      appId: "1:726550257989:web:12f251080da43b146dde2c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const modelos = ["Camisa Olimpica", "Camisa Olimpica Manga Longa", "Camisa Olimpica Gola V", "Long Look", "Long Look Manga Longa", "Long Look Gola V", "Camisa Polo Masculina", "Camisa Polo Feminina", "Baby look", "Regata Masculina", "Regata Feminina", "Camisa Haglan", "Machão", "Camisa infantil", "Camisa infantil Manga Longa"];
    const cores = ["Preto", "Branco", "Azul Marinho", "Mescla", "Azul Royal", "Vermelho", "Pink", "Rosa BB", "Azul BB", "Verde Bandeira", "Verde Musgo", "Amarelo Ouro", "Amarelo BB"];
    const malhas = ["Algodão", "Poliester", "Piquet", "PV", "Sarja", "Micro Fibra", "Ribana"];
    const tamanhos = ["1","2","4","6","8","10","12","14","PP","P","M","G","GG","G1","G2","G3","SG"];

    function popularSelect(id, lista, placeholder) {
      const select = document.getElementById(id);
      select.innerHTML = `<option value="">${placeholder}</option>`;
      lista.forEach(item => {
        const option = document.createElement("option");
        option.value = item;
        option.textContent = item;
        select.appendChild(option);
      });
    }

    function limparCampos() {
      ['modelo','cor','malha','tamanho','quantidade'].forEach(id => document.getElementById(id).value = '');
    }

    function entradaEstoque() {
      atualizarEstoque(+document.getElementById('quantidade').value);
    }

    function saidaEstoque() {
      atualizarEstoque(-document.getElementById('quantidade').value);
    }

    function atualizarEstoque(qtd) {
      const modelo = document.getElementById('modelo').value;
      const cor = document.getElementById('cor').value;
      const malha = document.getElementById('malha').value;
      const tamanho = document.getElementById('tamanho').value;
      if (!modelo || !cor || !malha || !tamanho || !qtd) return alert('Preencha todos os campos.');
      const id = `${modelo}_${cor}_${malha}_${tamanho}`;
      const ref = db.ref('estoque/' + id);
      ref.once('value').then(snapshot => {
        const atual = snapshot.val();
        const novaQtd = (atual ? atual.quantidade : 0) + qtd;
        if (novaQtd < 0) return alert('Estoque insuficiente.');
        ref.set({ modelo, cor, malha, tamanho, quantidade: novaQtd });
        atualizarTabela();
        limparCampos();
      });
    }

    function atualizarTabela() {
      const tabela = document.getElementById('tabelaEstoque');
      tabela.innerHTML = '';
      db.ref('estoque').once('value').then(snapshot => {
        snapshot.forEach(child => {
          const item = child.val();
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.modelo}</td>
            <td>${item.cor}</td>
            <td>${item.malha}</td>
            <td>${item.tamanho}</td>
            <td>${item.quantidade}</td>
            <td><button onclick="removerItem('${child.key}')">Remover</button></td>
          `;
          tabela.appendChild(tr);
        });
      });
    }

    function removerItem(id) {
      if (confirm('Tem certeza que deseja remover este item do estoque?')) {
        db.ref('estoque/' + id).remove().then(atualizarTabela);
      }
    }

    window.onload = () => {
      popularSelect('modelo', modelos, 'Escolha o modelo');
      popularSelect('cor', cores, 'Escolha a cor');
      popularSelect('malha', malhas, 'Escolha o tipo de malha');
      popularSelect('tamanho', tamanhos, 'Escolha o tamanho');
      atualizarTabela();
    }
  </script>
</body>
</html>
